<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Uy xo'jaligi so'rovnoma ‚Äî Responsive</title>

    <!-- Tailwind CDN (rapid prototyping uchun) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* small utility to visually hide required star for accessibility if needed */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <div
      class="min-h-screen flex items-start justify-center py-10 px-4 sm:px-6 lg:px-8"
    >
      <div
        class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-6 sm:p-8 md:p-10"
      >
        <h1 class="text-center text-2xl sm:text-3xl font-extrabold mb-6">
          üè° Uy xo'jaligi so'rovnoma
        </h1>

        <form id="form" class="space-y-6" autocomplete="off" novalidate>
          <!-- Grid top: Xudud, Tuman, Mahalla, Ko'cha -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1"
                >1. Xudud nomi <span class="text-red-500">*</span></label
              >
              <input
                required
                name="xudud_nomi"
                type="text"
                placeholder="Xudud nomi"
                class="block w-full rounded-lg border-gray-200 shadow-sm p-3 focus:ring-2 focus:ring-blue-400 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1"
                >2. Tuman/Shahar nomi <span class="text-red-500">*</span></label
              >
              <input
                required
                name="tuman_nomi"
                type="text"
                placeholder="Tuman yoki shahar"
                class="block w-full rounded-lg border-gray-200 shadow-sm p-3 focus:ring-2 focus:ring-blue-400 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1"
                >3. Mahalla nomi <span class="text-red-500">*</span></label
              >
              <input
                required
                name="mahalla_nomi"
                type="text"
                placeholder="Mahalla nomi"
                class="block w-full rounded-lg border-gray-200 shadow-sm p-3 focus:ring-2 focus:ring-blue-400 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1"
                >4. Ko‚Äòcha nomi <span class="text-red-500">*</span></label
              >
              <input
                required
                name="kocha_nomi"
                type="text"
                placeholder="Ko‚Äòcha nomi"
                class="block w-full rounded-lg border-gray-200 shadow-sm p-3 focus:ring-2 focus:ring-blue-400 focus:border-transparent"
              />
            </div>
          </div>

          <!-- 5: Uy manzili (3 kolonni mobilda bitta ustunda, planshetda ustma-ust 3 ta) -->
          <div>
            <label class="block text-sm font-medium mb-2">5. Uy manzili</label>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
              <input
                name="uy_raqami"
                type="text"
                placeholder="Uy raqami"
                class="rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
              <input
                name="korpus_raqami"
                type="text"
                placeholder="Korpus"
                class="rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
              <input
                name="xonadon_raqami"
                type="text"
                placeholder="Xonadon"
                class="rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
            </div>
          </div>

          <!-- 6: Yashaydimi? radios -->
          <div>
            <label class="block text-sm font-medium mb-2"
              >6. Manzilda odamlar yashaydimi?
              <span class="text-red-500">*</span></label
            >
            <div class="flex flex-col sm:flex-row sm:items-center gap-3">
              <label class="inline-flex items-center cursor-pointer">
                <input
                  required
                  type="radio"
                  name="yashaydi"
                  value="xa"
                  class="form-radio h-5 w-5 text-blue-600"
                />
                <span class="ml-3">Ha</span>
              </label>
              <label class="inline-flex items-center cursor-pointer">
                <input
                  required
                  type="radio"
                  name="yashaydi"
                  value="yoq"
                  class="form-radio h-5 w-5 text-blue-600"
                />
                <span class="ml-3">Yo‚Äòq</span>
              </label>
            </div>
          </div>

          <!-- 6.1: sababi (faqat Yo'q tanlanganda chiqadi) -->
          <div id="sababi-div" class="hidden">
            <label class="block text-sm font-medium mb-2"
              >6.1 Yashamaslik sababi</label
            >
            <div class="flex flex-col sm:flex-row gap-4 pl-2">
              <label class="inline-flex items-center cursor-pointer">
                <input
                  type="radio"
                  name="yashamaydi_sababi"
                  value="bosh"
                  class="form-radio h-5 w-5 text-blue-600"
                />
                <span class="ml-3">Bo'sh</span>
              </label>
              <label class="inline-flex items-center cursor-pointer">
                <input
                  type="radio"
                  name="yashamaydi_sababi"
                  value="mavsumiy"
                  class="form-radio h-5 w-5 text-blue-600"
                />
                <span class="ml-3">Mavsumiy</span>
              </label>
              <label class="inline-flex items-center cursor-pointer">
                <input
                  type="radio"
                  name="yashamaydi_sababi"
                  value="turar-joy emas"
                  class="form-radio h-5 w-5 text-blue-600"
                />
                <span class="ml-3">Turar-joy emas</span>
              </label>
            </div>
          </div>

          <!-- 7 - 13: statistik inputlar; responsive grid: mobil 1 ustun, sm 2 ustun -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1"
                >7. Nechta odam yashaydi? (kishi)
                <span class="text-red-500">*</span></label
              >
              <input
                required
                name="odam_soni"
                type="number"
                min="0"
                placeholder="Odamlar soni"
                class="w-full rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1"
                >8. Umumiy yer maydoni (sotix)
                <span class="text-red-500">*</span></label
              >
              <input
                required
                name="yer_maydoni"
                type="text"
                placeholder="Masalan: 8.6 yoki 9.3"
                class="w-full rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1"
                >9. Yirik shoxli mollar jami (bosh)
                <span class="text-red-500">*</span></label
              >
              <input
                required
                name="yirik_shoxli_mollar"
                type="number"
                min="0"
                placeholder="Nechta?"
                class="w-full rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1"
                >10. Qo‚Äòy va echkilar jami (bosh)
                <span class="text-red-500">*</span></label
              >
              <input
                required
                name="qoy_echki_soni"
                type="number"
                min="0"
                placeholder="Nechta?"
                class="w-full rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1"
                >11. Parrandalar soni (bosh)
                <span class="text-red-500">*</span></label
              >
              <input
                required
                name="parranda_soni"
                type="number"
                min="0"
                placeholder="Nechta?"
                class="w-full rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1"
                >12. Mevali daraxtlar soni (ta)
                <span class="text-red-500">*</span></label
              >
              <input
                required
                name="mevali_daraxtlar"
                type="number"
                min="0"
                placeholder="Nechta?"
                class="w-full rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
            </div>

            <div class="sm:col-span-2">
              <label class="block text-sm font-medium mb-1"
                >13. Manzarali daraxtlar soni (ta)
                <span class="text-red-500">*</span></label
              >
              <input
                required
                name="manzarali_daraxtlar"
                type="number"
                min="0"
                placeholder="Nechta?"
                class="w-full rounded-lg border-gray-200 p-3 focus:ring-2 focus:ring-blue-400"
              />
            </div>
          </div>

          <!-- Submit -->
          <div class="flex flex-col sm:flex-row gap-3">
            <button
              id="submit-btn"
              type="submit"
              class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg shadow"
            >
              Yuborish
            </button>

            <a
              href="/hammaData.html"
              class="flex-1 text-center bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg shadow"
            >
              Hamma ma'lumotlarni ko'rish
            </a>
          </div>

          <p id="status" class="text-center text-sm text-gray-600"></p>
        </form>
      </div>
    </div>

    <!-- SCRIPT: toggling sababi-div va submit logic -->
    <script>
      (function () {
        const form = document.getElementById('form');
        const sababiDiv = document.getElementById('sababi-div');
        const status = document.getElementById('status');
        const submitBtn = document.getElementById('submit-btn');

        // API endpoint (o'zingizga moslab o'zgartiring)
        const API_URL = 'https://requestions.onrender.com'; // <-- agar boshqa bo'lsa shu yerga qo'ying

        // Toggle sababi-div based on radios
        form.addEventListener('change', (e) => {
          if (e.target.name === 'yashaydi') {
            sababiDiv.classList.toggle('hidden', e.target.value === 'xa');
          }
        });

        // Submit handler
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          status.textContent = '';
          submitBtn.disabled = true;
          submitBtn.classList.add('opacity-70', 'cursor-not-allowed');
          submitBtn.textContent = 'Yuborilmoqda...';

          try {
            const formData = Object.fromEntries(new FormData(form));

            // agar yashaydi = xa bo'lsa, sababi maydonni bo'shatamiz
            if (formData.yashaydi === 'xa') {
              formData.yashamaydi_sababi = '';
            }

            // Convert numeric fields to numbers (optional but recommended)
            [
              'odam_soni',
              'yirik_shoxli_mollar',
              'qoy_echki_soni',
              'parranda_soni',
              'mevali_daraxtlar',
              'manzarali_daraxtlar',
            ].forEach((k) => {
              if (formData[k] !== undefined && formData[k] !== '') {
                const n = Number(formData[k]);
                formData[k] = Number.isNaN(n) ? formData[k] : n;
              }
            });

            const resp = await fetch(API_URL + '/submit', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(formData),
              mode: 'cors',
            });

            if (!resp.ok) {
              const err = await resp
                .json()
                .catch(() => ({ error: 'Server xatosi' }));
              throw new Error(err.error || 'Serverdan javob olishda xatolik');
            }

            const data = await resp.json();
            status.textContent =
              '‚úÖ ' + (data.message || 'Ma ºlumotlar saqlandi');
            status.classList.remove('text-red-500');
            status.classList.add('text-green-600');

            form.reset();
            sababiDiv.classList.add('hidden');
          } catch (err) {
            console.error('Submit error:', err);
            status.textContent = '‚ùå Xato: ' + (err.message || 'Yuborilmadi');
            status.classList.remove('text-green-600');
            status.classList.add('text-red-500');
          } finally {
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');
            submitBtn.textContent = 'Yuborish';
          }
        });
      })();
    </script>
  </body>
</html>
